@model UpdateProfileVM

@{
    ViewBag.Title = "Account | Update Profile";
    Layout = "";
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Update Profile - My Event</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <link rel="stylesheet" href="~/style/Update.css" />

    <style>
        .LoginPageUpload {
            display: inline-block;
            cursor: pointer;
        }

            .LoginPageUpload img {
                display: block;
                width: 120px;
                height: 120px;
                object-fit: cover;
                border-radius: 30%;
                margin-top: 5px;
                border: 1px solid #ccc;
            }
    </style>
</head>
<body>

    <main class="login-wrapper">
        <div class="login-container">

            <!-- Heading goes OUTSIDE the form -->
            <img style="border-radius:30%; object-fit:cover; width:30%; height:30%;" src="~/images/Logo/MyEvently.png" />
            <h2 class="title">Update Profile</h2>

            <form class="form" method="post" enctype="multipart/form-data">
                <div asp-validation-summary="ModelOnly" class="validation-summary"></div>

                <div class="form-group">
                    <label asp-for="Email"></label>
                    <b>@Model.Email</b>
                </div>

                <div class="form-group">
                    <label asp-for="Name"></label>
                    <input asp-for="Name" autofocus />
                    <span asp-validation-for="Name"></span>
                </div>

                <div class="form-group">
                    <label asp-for="Photo"></label>
                    <label class="LoginPageUpload">
                        <small>Select Photo...</small>
                        <input asp-for="Photo" accept="image/jpeg,image/png" hidden />
                        <img src="~/images/Profile/@Model.PhotoURL" />
                    </label>
                    <span asp-validation-for="Photo"></span>
                </div>

                <div class="form-actions">
                    <button class="login-btn">Update</button>
                    <button type="reset" class="reset-btn">Reset</button>
                </div>
            </form>

            <p class="links">
                [ <a href="/Login">Login</a> ]
            </p>
        </div>
    </main>

    <script>
                $(document).ready(function() {
            $('.LoginPageUpload input[type="file"]').on('change', function() {
                const file = this.files[0];
                const img = $(this).siblings('img')[0];
                if (!img) return;

                // Save original src once
                if (!img.dataset.originalSrc) img.dataset.originalSrc = img.src;

                if (file && file.type.startsWith('image/')) {
                    const objectUrl = URL.createObjectURL(file);
                    img.src = objectUrl;
                    img.onload = () => URL.revokeObjectURL(objectUrl);
                } else {
                    img.src = img.dataset.originalSrc;
                    this.value = '';
                }
            });
        });
    </script>
</body>
</html>
